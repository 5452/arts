# 一致性总结

> * 本着思考归纳总结的原则，尝试整理一下一致性相关的知识，构建自己的知识体系。

## 什么叫一致性
一致性就是数据保持一致，按照使用场景和要求严格程度不同，又大致可分为强一致性和弱一致性。
> [维基百科对一致性的解释](https://en.wikipedia.org/wiki/Consistency_model)（维基百科一致性问题针对分布式系统，但是我认为单实例，比如单点数据库系统中也存在一致性问题--事务管理和隔离级别，后文会有进一步说明）

## 严格一致性
严格一致性要求所有任何更改立即能同步到其他所有进程或节点，任何读操作都可以读取到最新更改，任意时刻任何进程或节点读取到的数据是一致的，不存在矛盾分歧。

在分布式系统中，因为存在多个节点，在这种场景下很难做到，要么是代价太大，丧失了分布式的优势，所以严格一致性在分布式的实际生产环境中目前无法实现。

## 弱一致性
#### 顺序一致性
顺序一致性是指所有的进程或节点看到的所有修改的顺序是相同的一致的，每一个进程或节点或许在同一时刻读到的值是不同的，但是他们读取到的值的变化顺序是一致的，可以理解为对某个值的修改是串行有顺序的。
#### 因果一致性
因果一致性比顺序一致性更弱化了一些，它不要求所有进程或节点以同一顺序读取到修改值，但是要求所有所有进程必须以相同的顺序读取到与自己有潜在因果的写操作，不同进程或节点可以以不同的顺序看到并发的写操作。
#### FIFO 一致性
FIFO 一致性进一步弱化，不要求所有潜在因果关系的写操作以相同的顺序被读取，不同进程的可以以不同的顺序看到不同进程的写操作，但是要求某一个进程的写操作在可以被其他所有进程看到的时候，顺序必须是一致的，但是两个进程的写操作顺序性不受保证，如 P1 顺序进行了 W1 和 W3 两次写操作，P2 顺序进行了 W2 和 W4 两次写操作，FIFO 一致性只保证  W1、 W3 以及 W2 、W4 的顺序性，其他进程看到的顺序有可能是 W1 W3 W2 W4，也有可能是 W2 W1 W3 W4，即使有因果关系也不受保证。

## 最终一致性

最终一致性属于弱一致性的一种，多存在于搜索引擎和DNS等系统中，最终一致性可能会在某一个时间窗口内，多个进程可能会在同一时间看到同一个变量的值是不同的，但是在这个时间窗口之后，所有的进程都会看到相同的更改后的值。

## 一致性实现方式与协议
### TODO，这个了解不多，下周做完功课会补上。

## 单实例环境下的强一致性
单实例环境下，很少会提一致性，但是绕不开事务。我认为事务的隔离级别亦即是一致性保证的问题范畴。

串行、可重复读、不可重复读、读未提交的四个事物隔离级对应了一致性从强到弱的约束。

关于数据库事务隔离和事务性的保证策略会有另外的文章总结。